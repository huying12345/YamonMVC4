function formatCurrency(e){return e.toFixed(2)}function GetProductInfolist(){YamonAPI.POST("/api/Product/VProductInfo/GetProductListByModels",function(e){for(var o=[],r=0;r<e.rows.length;r++)o.push(new CartLine(e.rows[r]));ko.applyBindings(new index(o)),$("#sample-table-2").rowspan(0),$("input[class='Num']").TouchSpin()})}var indexViewModel=function(){var e=this;e.init=function(){if(jQuery("#vbookd").removeClass("active"),null!=$.cookie("__isMemberLogin")){var e=new Date,o=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();jQuery("#MakeTime").val(o),$("#sample-table-2").rowspan(0),GetProductInfolist()}else alert("请先登录!"),window.location.href="Login.html"}},CartLine=function(e){var o=this;o.ProductName=ko.observable(e.ProductName),o.SalePrice=ko.observable(e.SalePrice),o.TypeName=ko.observable(e.TypeName),o.ProductID=ko.observable(e.ProductInfoId),o.ProductNo=ko.observable(e.ProductInfoNo),o.Num=ko.observable(0),o.TotalMoney=ko.pureComputed(function(){return o.SalePrice()*o.Num()})},index=function(e){var o=this;o.lines=ko.observableArray(e),o.grandTotal=ko.pureComputed(function(){var e=0;return $.each(o.lines(),function(r){e+=o.lines()[r].SalePrice()*o.lines()[r].Num()}),e}),o.save=function(){var e=!1,r=$.map(o.lines(),function(o){return"0"!=o.Num()?(e=!0,[{ProductID:o.ProductID(),ProductNo:o.ProductNo(),Price:o.SalePrice(),Num:o.Num(),TotalMoney:parseFloat(o.Num())*parseFloat(o.SalePrice()),MakeTime:jQuery("#MakeTime").val(),SalePrice:o.SalePrice()}]):void 0}),t={TotalMoney:$("#TotalMoney").text(),Models:"Ticket",MakeTime:jQuery("#MakeTime").val()};t.json=ko.utils.stringifyJson(r),e?YamonAPI.POST("/api/Product/ProductBook/Create",t,function(e){e.success?(alert("预约成功"),window.location.href="orderlist.html"):alert("提交失败")}):alert("请选择票数！")}};